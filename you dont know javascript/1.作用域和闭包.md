## 编译原理
在传统的编译流程中，编译分为3个步骤
1. 分词/词法分析
2. 解析/语法分析
3. 代码生成

JavaScript不会有大量的时间用来优化，因此，JavaScript引擎用尽了各种办法（如JIT）来保证性能。

## 理解作用域
`var a = 2;`
处理步骤：
1. 编译器询问作用域是否有a，没有则在当前作用域下声明一个新的变量，并命名为a。
2. 引擎询问作用域是否存在该变量，存在则赋值，否则到上层作用域中查找

### 编译器术语
引擎查找变量分为两种：LHS查询和RHS查询
LHS查询试图找到变量的容器本身
RHS查询理解为找到它的源值(retrieve his source value)

### 作用域嵌套
当一个块或函数嵌套在另一个块或函数中时，就发生了作用域的嵌套。因此，在当前作用于中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，直到找到该变量，或抵达最外层的作用域为止。

### 异常
如果RHS查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出ReferenceError异常。值得注意的是，Reference是非常重要的异常类型。
如果在非严格模式下，LHS查询会自动创建不存在的变量

如果RHS查询找到了一个变量，但是你尝试对这个变量进行不合理的操作，如对一个非函数类型的变量进行函数调用，或引用null或undefined中的属性，则会抛出TypeError。

### 小结
作用域是一套规则，用于确定在何处以及如何查找变量。
如果查找的目的是对变量进行赋值，那么就会使用LHS查询。
如果目标是获取变量的值，就会使用RHS查询。

JavaScript引擎首先会在代码执行前对其进行编译，在这个过程中，像`var a=2`这样的声明会有两个步骤：
1. 首先，var a在其作用域中声明新变量。这会在最开始的阶段，也就是代码执行前进行。
2. 接下来，a=2会查询(LHS查询)变量a并对其赋值。

LHS查询和RHS查询都会在当前作用域中开始，如果有需要，就会向上级作用域继续查找目标标识符，这样每次上升一级作用域，最后抵达全局作用域，无论找到或没找到都将停止。



